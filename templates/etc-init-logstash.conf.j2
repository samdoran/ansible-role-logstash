# logstash rsyslog shipper
#

description     "logstash shipper that sends rsyslog files"

start on runlevel [35]
stop on runlevel [016]

# Respawn it if the process exits
respawn
respawn limit 5 30
limit nofile 65550 65550
expect fork

# You need to chdir somewhere writable because logstash needs to unpack a few
# temporary files on startup.
chdir /var/logstash

env LS_BIN=/opt/logstash/logstash.jar
env LS_CONFIG=/etc/logstash/{% if 'ls_parser' in group_names %}parser{% endif %}{% if "ls_shipper" in group_names %}shipper{% endif %}.conf
env LS_LOG=/var/log/logstash.log

script

  # This runs logstash agent as the 'logstash' user
  su -s /bin/sh -c 'exec "$0" "$@"' logstash -- /usr/bin/java -jar $LS_BIN agent -f $LS_CONFIG --log $LS_LOG -v &
  emit logstash-agent-running

end script
